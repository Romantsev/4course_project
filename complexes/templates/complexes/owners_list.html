{% extends "complexes/base.html" %}
{% block title %}Власники{% endblock %}

{% block content %}
<h3>Власники</h3>

<form method="get" id="filter-form" class="mb-3">
  <div class="row g-2 align-items-center">
      <div class="col-auto">
          <label class="form-label mb-0" for="id_complex_filter">ЖК</label>
          <select id="id_complex_filter" name="complex" class="form-select">
              <option value="">--- Виберіть ЖК ---</option>
              {% if complexes %}
                  {% for c in complexes %}
                      <option value="{{ c.complex_id }}" {% if selected_complex == c.complex_id %}selected{% endif %}>
                          {{ c.name }}
                      </option>
                  {% endfor %}
              {% endif %}
          </select>
      </div>
  </div>
</form>

<script>
document.getElementById('id_complex_filter').addEventListener('change', function() {
    document.getElementById('filter-form').submit();
});
</script>

<table class="table table-striped">
  <thead>
    <tr>
      <th>ПІБ</th>
      <th>Телефон</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    {% for o in owners %}
    <tr>
      <td>{{ o.name }}</td>
      <td>{{ o.phone }}</td>
      <td>
        {% if user.is_superuser or user.is_authenticated %}
        <a href="{% url 'owner_edit' o.owner_id %}" class="btn btn-sm btn-primary">Редагувати</a>
        <a href="{% url 'owner_delete' o.owner_id %}" class="btn btn-sm btn-danger">Видалити</a>
        {% endif %}
      </td>
    </tr>
    {% empty %}
    <tr><td colspan="4">Власників поки не створено.</td></tr>
    {% endfor %}
  </tbody>
</table>

{% if form %}
<h4>Додати власника</h4>
<form method="post" class="card p-3">
  {% csrf_token %}
  <div class="row g-2">
    <div class="col-md-5 d-flex flex-column">
      <label class="form-label" for="id_owner_name">ПІБ</label>
      {{ form.name }}
      <div class="text-danger small mt-1" style="min-height: 1.25em;">
        {% if form.name.errors %}
          {{ form.name.errors.0 }}
        {% endif %}
      </div>
    </div>

    <div class="col-md-5 d-flex flex-column">
      <label class="form-label" for="id_owner_phone">Телефон</label>
      {{ form.phone }}
      <div class="text-danger small mt-1" style="min-height: 1.25em;">
        {% if form.phone.errors %}
          {{ form.phone.errors.0 }}
        {% endif %}
      </div>
    </div>

    <div class="col-md-2 pt-4">
      <button class="btn btn-success w-100" type="submit">Додати</button>
    </div>
  </div>
</form>



{% endif %}
{% endblock %}

